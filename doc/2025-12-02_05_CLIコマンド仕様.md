# snaperro CLIã‚³ãƒãƒ³ãƒ‰ä»•æ§˜

## æ¦‚è¦

snaperroã¯CLIãƒ„ãƒ¼ãƒ«ã¨ã—ã¦æä¾›ã•ã‚Œã€`npx snaperro` ã‚³ãƒãƒ³ãƒ‰ã§æ“ä½œã—ã¾ã™ã€‚

---

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install -D snaperro
# ã¾ãŸã¯
pnpm add -D snaperro
# ã¾ãŸã¯
yarn add -D snaperro
```

---

## ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|---------|------|
| `npx snaperro init` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ– |
| `npx snaperro start` | ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹• |
| `npx snaperro postman` | Postmanã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‡ºåŠ› |

---

## npx snaperro init

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚

### å®Ÿè¡Œ

```bash
npx snaperro init
```

### å‡¦ç†å†…å®¹

1. `.snaperro/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
2. `.snaperro/files/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
3. `.snaperro/state.json` ã‚’ä½œæˆï¼ˆåˆæœŸçŠ¶æ…‹ï¼‰
4. `snaperro.config.ts` ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆï¼ˆå­˜åœ¨ã—ãªã„å ´åˆï¼‰
5. `.gitignore` ã« `.snaperro/` ã‚’è¿½åŠ ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆï¼‰

### å‡ºåŠ›ä¾‹

```
$ npx snaperro init

ğŸ• snaperro init

âœ“ Created .snaperro/
âœ“ Created .snaperro/files/
âœ“ Created .snaperro/state.json
âœ“ Created snaperro.config.ts
âœ“ Added .snaperro/ to .gitignore

Done! Run 'npx snaperro start' to start the server.
```

### ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

#### .snaperro/state.json

```json
{
  "mode": "proxy",
  "currentPattern": null
}
```

#### snaperro.config.ts

```typescript
import { defineConfig } from 'snaperro'

export default defineConfig({
  port: 3333,
  filesDir: '.snaperro/files',

  apis: {
    // APIå®šç¾©ã‚’ã“ã“ã«è¿½åŠ 
    // example: {
    //   name: "Example API",
    //   target: "https://api.example.com",
    //   headers: {
    //     "X-Api-Key": process.env.EXAMPLE_API_KEY!,
    //   },
    //   routes: [
    //     "/api/example",
    //     "/api/example/:id",
    //   ],
    // },
  },
})
```

### ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹

#### æ—¢ã«åˆæœŸåŒ–æ¸ˆã¿ã®å ´åˆ

```
$ npx snaperro init

ğŸ• snaperro init

âš  .snaperro/ already exists
? Do you want to reinitialize? (y/N)
```

---

## npx snaperro start

ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚

### å®Ÿè¡Œ

```bash
npx snaperro start
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|----------|
| `--port`, `-p` | ãƒãƒ¼ãƒˆç•ªå·ã‚’æŒ‡å®š | è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å€¤ ã¾ãŸã¯ `3333` |

### ä½¿ç”¨ä¾‹

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆã§èµ·å‹•
npx snaperro start

# ãƒãƒ¼ãƒˆ4000ã§èµ·å‹•
npx snaperro start --port 4000
npx snaperro start -p 4000
```

### å‡¦ç†å†…å®¹

1. `snaperro.config.ts` ã‚’èª­ã¿è¾¼ã¿
2. è¨­å®šã‚’æ¤œè¨¼
3. `.snaperro/state.json` ã‹ã‚‰å‰å›ã®çŠ¶æ…‹ã‚’å¾©å…ƒ
4. ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•

### å‡ºåŠ›ä¾‹

```
$ npx snaperro start

ğŸ• snaperro server starting...

  Config: snaperro.config.ts
  Port: 3333
  Mode: mock (restored from previous session)
  Pattern: æ­£å¸¸ç³»ãƒ•ãƒ« (restored from previous session)

  APIs loaded:
  - userService (5 routes)
  - orderService (4 routes)
  - authService (4 routes)

âœ“ Server running at http://localhost:3333

  GUI: http://localhost:3333
  Control API: http://localhost:3333/__snaperro__/

Press Ctrl+C to stop
```

### çŠ¶æ…‹ã®å¾©å…ƒ

ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ã« `.snaperro/state.json` ã‚’èª­ã¿è¾¼ã¿ã€å‰å›ã®ãƒ¢ãƒ¼ãƒ‰ã¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¾©å…ƒã—ã¾ã™ã€‚

```json
// .snaperro/state.json
{
  "mode": "mock",
  "currentPattern": "æ­£å¸¸ç³»ãƒ•ãƒ«"
}
```

å¾©å…ƒã•ã‚Œã‚‹é …ç›®ï¼š
- **mode**: å‰å›ã®ãƒ¢ãƒ¼ãƒ‰ï¼ˆproxy/record/mockï¼‰
- **currentPattern**: å‰å›é¸æŠã—ã¦ã„ãŸãƒ‘ã‚¿ãƒ¼ãƒ³

### ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹

#### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆ

```
$ npx snaperro start

Error: Configuration file not found.
Run 'npx snaperro init' first.
```

#### è¨­å®šãŒä¸æ­£ãªå ´åˆ

```
$ npx snaperro start

Error: Invalid configuration
- apis.userService.target: Invalid URL
- apis.orderService.routes: Cannot be empty

Please fix snaperro.config.ts and try again.
```

#### ãƒãƒ¼ãƒˆãŒä½¿ç”¨ä¸­ã®å ´åˆ

```
$ npx snaperro start

Error: Port 3333 is already in use.
Try a different port: npx snaperro start --port 4000
```

---

## npx snaperro postman

Postmanã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›ã—ã¾ã™ã€‚

### å®Ÿè¡Œ

```bash
npx snaperro postman
```

### å‡¦ç†å†…å®¹

1. `debug/postman-collection.json` ã‚’èª­ã¿è¾¼ã¿
2. JSONå½¢å¼ã§æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›

### ä½¿ç”¨ä¾‹

```bash
# æ¨™æº–å‡ºåŠ›ã«è¡¨ç¤º
npx snaperro postman

# ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
npx snaperro postman > snaperro-collection.json

# Postmanã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
# 1. å‡ºåŠ›ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
# 2. Postman â†’ Import â†’ Upload Files ã§èª­ã¿è¾¼ã¿
```

### å‡ºåŠ›ä¾‹

```json
{
  "info": {
    "_postman_id": "snaperro-api-collection",
    "name": "snaperro API Collection",
    "description": "snaperro (ã‚¹ãƒŠãƒšãƒ¼ãƒ­) - GUIä»˜ããƒ¢ãƒƒã‚¯ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã®APIé›†",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3333",
      "type": "string"
    }
  ],
  "item": [...]
}
```

### ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹

#### ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„å ´åˆ

```
$ npx snaperro postman

Error: debug/postman-collection.json ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
```

---

## ç’°å¢ƒå¤‰æ•°

### SNAPERRO_PORT

ãƒãƒ¼ãƒˆç•ªå·ã‚’ç’°å¢ƒå¤‰æ•°ã§æŒ‡å®šã§ãã¾ã™ã€‚

```bash
SNAPERRO_PORT=4000 npx snaperro start
```

å„ªå…ˆé †ä½ï¼š
1. `--port` ã‚ªãƒ—ã‚·ãƒ§ãƒ³
2. `SNAPERRO_PORT` ç’°å¢ƒå¤‰æ•°
3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã® `port`
4. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ `3333`

---

## npm scripts ã§ã®ä½¿ç”¨

### package.json

```json
{
  "scripts": {
    "mock": "snaperro start",
    "mock:init": "snaperro init"
  }
}
```

### ä½¿ç”¨ä¾‹

```bash
npm run mock
npm run mock:init
```

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [æ¦‚è¦](./2025-12-02_01_æ¦‚è¦.md)
- [ã‚µãƒ¼ãƒãƒ¼ä»•æ§˜](./2025-12-02_02_ã‚µãƒ¼ãƒãƒ¼ä»•æ§˜.md)
- [å†…éƒ¨APIä»•æ§˜](./2025-12-02_03_å†…éƒ¨APIä»•æ§˜.md)
- [è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä»•æ§˜](./2025-12-02_04_è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä»•æ§˜.md)
- [JSONã‚¹ã‚­ãƒ¼ãƒä»•æ§˜](./2025-12-02_06_JSONã‚¹ã‚­ãƒ¼ãƒä»•æ§˜.md)
