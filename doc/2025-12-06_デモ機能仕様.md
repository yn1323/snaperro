# snaperro デモ機能仕様書

## 概要

snaperroの動作を開発者・ユーザーが実際に体験できるデモページを作成する。

### 目的

1. **開発者向け**: 実装した機能が正しく動作しているかの確認環境
2. **ユーザー向け**: snaperroの使い方を理解するための体験環境
3. **共通**: Proxy/Record/Mockの違いを直感的に理解できる

### コンセプト

「snaperroを使う開発者の視点」を再現する。

```
[demo = 開発中のアプリ] → [snaperro:3333] → [JSON Placeholder API]
                              ↓
                    [GUI: /__snaperro__/client で管理]
```

デモは「開発中のフロントエンド」として振る舞い、snaperro経由でAPIを叩く。
詳細な管理（シナリオ/ファイル/JSON編集）は既存GUIへ誘導する。

---

## 機能要件

### デモで体験できること

| 機能 | 説明 |
|-----|------|
| モード切替 | Proxy/Record/Mockの切替と動作の違いを体験 |
| Path Parameter | `/users/:id` でIDごとに異なるレスポンスを保存・返却 |
| Query String | `/posts?userId=1` でクエリごとに異なるレスポンスを保存・返却 |
| Nested Resource | `/posts/:id/comments` でネストしたリソースの取得 |
| GUIへの誘導 | JSONを編集してMockで確認するフローを案内 |

### デモでやらないこと（GUIでやる）

- シナリオ管理（作成/複製/削除/ZIP）
- ファイル管理（ツリー/検索/アップロード）
- JSONエディタ

---

## 使用するAPI（JSON Placeholder）

| カテゴリ | エンドポイント | 説明 | 体験できる機能 |
|---------|--------------|------|---------------|
| Basic | `GET /users` | ユーザー一覧 | 基本的なAPI呼び出し |
| Basic | `GET /posts` | 投稿一覧 | 基本的なAPI呼び出し |
| Basic | `GET /comments` | コメント一覧 | 基本的なAPI呼び出し |
| Path Param | `GET /users/:id` | ユーザー詳細 | **パスパラメータ** |
| Path Param | `GET /posts/:id` | 投稿詳細 | **パスパラメータ** |
| Query String | `GET /posts?userId=:id` | ユーザーの投稿 | **クエリストリング** |
| Query String | `GET /comments?postId=:id` | 投稿のコメント | **クエリストリング** |
| Nested | `GET /posts/:id/comments` | 投稿のコメント | **ネストリソース** |

### ファイル保存例

#### パスパラメータ

```
GET /users/1  → .snaperro/files/{scenario}/users_{id}_001.json
                request.pathParams: { id: "1" }

GET /users/2  → .snaperro/files/{scenario}/users_{id}_002.json
                request.pathParams: { id: "2" }
```

#### クエリストリング

```
GET /posts?userId=1  → .snaperro/files/{scenario}/posts_001.json
                       request.queryParams: { userId: "1" }

GET /posts?userId=2  → .snaperro/files/{scenario}/posts_002.json
                       request.queryParams: { userId: "2" }
```

---

## 画面構成

### レイアウト

```
┌──────────────────────────────────────────────────────────────────────────┐
│  Header                                                                  │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │ 🐕 snaperro demo      [Proxy] [Record] [Mock]         [Open GUI]  │  │
│  └────────────────────────────────────────────────────────────────────┘  │
├──────────────────────────────────────────────────────────────────────────┤
│  Main Content                                                            │
│  ┌──────────────────────────────────────────────────────────────────────┐│
│  │ Scenario Grid                                                        ││
│  │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                     ││
│  │ │ Users       │ │ Posts       │ │ Comments    │  ← Basic            ││
│  │ └─────────────┘ └─────────────┘ └─────────────┘                     ││
│  │                                                                      ││
│  │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                     ││
│  │ │ User by ID  │ │ Posts by    │ │ Post        │  ← Advanced         ││
│  │ │ /users/:id  │ │ User        │ │ Comments    │                     ││
│  │ │ [1▼][実行]  │ │ ?userId=    │ │ /posts/:id/ │                     ││
│  │ └─────────────┘ └─────────────┘ └─────────────┘                     ││
│  └──────────────────────────────────────────────────────────────────────┘│
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────────┐│
│  │ Response Panel                                                       ││
│  │ GET /users/1                                         Status: 200    ││
│  │ Mode: [Proxy] → jsonplaceholder.typicode.com                        ││
│  │ ┌──────────────────────────────────────────────────────────────────┐││
│  │ │ { "id": 1, "name": "Leanne Graham", ... }                        │││
│  │ └──────────────────────────────────────────────────────────────────┘││
│  └──────────────────────────────────────────────────────────────────────┘│
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────────┐│
│  │ Guide Panel                                                          ││
│  │ 💡 Try this:                                                         ││
│  │ 1. [Record]モードで「User by ID」を実行 → ファイル保存               ││
│  │ 2. [Open GUI]でJSONを編集                                            ││
│  │ 3. [Mock]モードで同じリクエスト → 編集したデータが返る               ││
│  └──────────────────────────────────────────────────────────────────────┘│
└──────────────────────────────────────────────────────────────────────────┘
```

### コンポーネント一覧

| コンポーネント | 役割 |
|--------------|------|
| Header | ロゴ、モード切替、GUIへのリンク |
| ModeSelector | Proxy/Record/Mock切替ボタン |
| ScenarioGrid | シナリオカードのグリッド表示 |
| ScenarioCard | 個別シナリオ（パラメータ選択、実行ボタン） |
| ResponsePanel | APIレスポンスの表示 |
| GuidePanel | ステップバイステップのガイド |

---

## 技術仕様

### アクセスURL

- デモ: `http://localhost:3333/__snaperro__/demo`
- GUI: `http://localhost:3333/__snaperro__/client`

### 技術スタック

- React 19
- Vite 6
- TailwindCSS 4
- TypeScript

### ディレクトリ構成

```
snaperro/
├── client/                 # 既存GUI（変更なし）
├── demo/                   # 新規: デモ用フロントエンド
│   ├── index.html
│   ├── vite.config.ts
│   ├── postcss.config.js
│   ├── tailwind.config.js
│   ├── tsconfig.json
│   └── src/
│       ├── main.tsx
│       ├── index.css
│       ├── App.tsx
│       ├── scenarios.ts
│       └── components/
│           ├── Header.tsx
│           ├── ModeSelector.tsx
│           ├── ScenarioGrid.tsx
│           ├── ScenarioCard.tsx
│           ├── ResponsePanel.tsx
│           └── GuidePanel.tsx
├── cli/commands/
│   └── demo.ts             # 新規
└── dist/
    └── demo/               # ビルド出力
```

### デザイン仕様

#### カラーパレット（ダークモード）

| 変数 | 値 | 用途 |
|-----|-----|------|
| --bg-primary | #0a0a0b | 最も暗い背景 |
| --bg-secondary | #141416 | カード背景 |
| --bg-tertiary | #1c1c1f | ホバー等 |
| --text-primary | #fafafa | 主要テキスト |
| --text-secondary | #a1a1aa | 補助テキスト |
| --accent-cyan | #22d3ee | Proxyモード |
| --accent-red | #f87171 | Recordモード |
| --accent-green | #4ade80 | Mockモード |
| --border | #27272a | ボーダー |

#### フォント

- 見出し/コード: JetBrains Mono（モノスペース）
- 本文: system-ui

---

## CLIコマンド

### `npx snaperro demo`

デモ環境を起動する。

```bash
npx snaperro demo
npx snaperro demo --port 3334
```

#### 処理フロー

1. `.snaperro/files` が存在しなければ `init` 相当の処理を実行
2. デモ用の設定でサーバーを起動（JSON Placeholder API向け）
3. ブラウザで `http://localhost:3333/__snaperro__/demo` を開く

---

## 実装計画

### Phase 1: 基盤構築

**目的**: デモ用フロントエンドのプロジェクト構造を作成し、ビルド・配信の仕組みを整える。

**理由**:
- 既存の `client/` と同様の構成にすることで、保守性を確保
- サーバーからの配信ルートを先に確立することで、開発中もすぐに動作確認できる

**タスク**:

| # | タスク | ファイル | 詳細 |
|---|-------|---------|------|
| 1-1 | demo/ ディレクトリ作成 | `demo/*` | Vite + React + TailwindCSS の基本構成 |
| 1-2 | ビルドスクリプト追加 | `package.json` | `dev:demo`, `build:demo` スクリプト |
| 1-3 | サーバー配信ルート追加 | `server/handlers/index.ts` | `/__snaperro__/demo/*` のルーティング |

**成果物**:
- `pnpm dev:demo` でデモ開発サーバー起動
- `pnpm build:demo` でビルド → `dist/demo/` に出力
- `http://localhost:3333/__snaperro__/demo` でアクセス可能

---

### Phase 2: コアUI実装

**目的**: デモの基本UIを実装し、モード切替とAPI呼び出しができる状態にする。

**理由**:
- まずモード切替とレスポンス表示という核心機能を動かす
- シナリオは後から追加しやすい構造にしておく

**タスク**:

| # | タスク | ファイル | 詳細 |
|---|-------|---------|------|
| 2-1 | Header + ModeSelector | `demo/src/components/Header.tsx`, `ModeSelector.tsx` | モード切替UI、GUIリンク |
| 2-2 | シナリオ定義 | `demo/src/scenarios.ts` | API呼び出しシナリオのデータ定義 |
| 2-3 | ScenarioGrid + ScenarioCard | `demo/src/components/ScenarioGrid.tsx`, `ScenarioCard.tsx` | シナリオ選択UI |
| 2-4 | ResponsePanel | `demo/src/components/ResponsePanel.tsx` | レスポンス表示 |
| 2-5 | App.tsx 統合 | `demo/src/App.tsx` | 全コンポーネントの統合、状態管理 |

**成果物**:
- モード切替が動作
- シナリオを選んでAPI呼び出し
- レスポンスが表示される

---

### Phase 3: ガイド・仕上げ

**目的**: ユーザーガイドを追加し、デモとしての完成度を高める。

**理由**:
- 初見ユーザーでも操作フローがわかるようにする
- GUIへの誘導を自然に行う

**タスク**:

| # | タスク | ファイル | 詳細 |
|---|-------|---------|------|
| 3-1 | GuidePanel | `demo/src/components/GuidePanel.tsx` | ステップバイステップのガイド表示 |
| 3-2 | スタイリング調整 | `demo/src/index.css` | アニメーション、レスポンシブ対応 |

**成果物**:
- ガイドパネルでフローが案内される
- 視覚的に洗練されたUI

---

### Phase 4: CLIコマンド

**目的**: `npx snaperro demo` コマンドでデモ環境を起動できるようにする。

**理由**:
- ユーザーが簡単にデモを試せる
- 開発者も動作確認が容易になる

**タスク**:

| # | タスク | ファイル | 詳細 |
|---|-------|---------|------|
| 4-1 | demo コマンド作成 | `cli/commands/demo.ts` | デモ起動コマンドの実装 |
| 4-2 | CLI登録 | `cli/index.ts` | `demo` コマンドの登録 |

**成果物**:
- `npx snaperro demo` でデモ起動
- 自動でブラウザが開く

---

### Phase 5: 動作確認・修正

**目的**: 全体の動作確認を行い、問題があれば修正する。

**タスク**:

| # | タスク | 詳細 |
|---|-------|------|
| 5-1 | 手動テスト | 各モードでのAPI呼び出し、レスポンス確認 |
| 5-2 | Path Parameter確認 | `/users/1`, `/users/2` で異なるファイル保存 |
| 5-3 | Query String確認 | `/posts?userId=1`, `/posts?userId=2` で異なるファイル保存 |
| 5-4 | GUI連携確認 | デモ → GUI → デモ のフロー確認 |
| 5-5 | ビルド確認 | `pnpm build` 後の動作確認 |

---

## 修正/作成が必要なファイル一覧

| ファイル | 操作 | Phase |
|----------|-----|-------|
| `demo/index.html` | 新規 | 1 |
| `demo/vite.config.ts` | 新規 | 1 |
| `demo/postcss.config.js` | 新規 | 1 |
| `demo/tailwind.config.js` | 新規 | 1 |
| `demo/tsconfig.json` | 新規 | 1 |
| `demo/src/main.tsx` | 新規 | 1 |
| `demo/src/index.css` | 新規 | 1 |
| `package.json` | 修正 | 1 |
| `server/handlers/index.ts` | 修正 | 1 |
| `demo/src/App.tsx` | 新規 | 2 |
| `demo/src/scenarios.ts` | 新規 | 2 |
| `demo/src/components/Header.tsx` | 新規 | 2 |
| `demo/src/components/ModeSelector.tsx` | 新規 | 2 |
| `demo/src/components/ScenarioGrid.tsx` | 新規 | 2 |
| `demo/src/components/ScenarioCard.tsx` | 新規 | 2 |
| `demo/src/components/ResponsePanel.tsx` | 新規 | 2 |
| `demo/src/components/GuidePanel.tsx` | 新規 | 3 |
| `cli/commands/demo.ts` | 新規 | 4 |
| `cli/index.ts` | 修正 | 4 |

---

## 関連ドキュメント

- [概要](./2025-12-02_01_概要.md)
- [サーバー仕様](./2025-12-02_02_サーバー仕様.md)
- [GUI仕様](./2025-12-04_GUI仕様.md)
