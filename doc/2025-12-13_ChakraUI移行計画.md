# Chakra UI 移行計画

## 背景

### 現状の問題

demo, client両ページのUIはすべてスクラッチのTailwind CSSで実装されている。

**発生している問題:**
- テキストが枠から飛び出す（Flexboxで`min-w-0`が欠如）
- レイアウトの一貫性が保ちにくい
- コンポーネントの再利用性が低い

**具体的な問題箇所:**
| ファイル | 問題 |
|---------|------|
| `demo/src/components/ResponsePanel.tsx` | URL、エラーメッセージのはみ出し |
| `client/src/components/FilePane.tsx` | ファイル名、エンドポイントのはみ出し |
| `client/src/components/PatternPane.tsx` | パターン名のはみ出し |
| `client/src/components/EditorPane.tsx` | JSONエラーメッセージのはみ出し |

### なぜChakra UIか

- Tailwindと併用可能（段階的移行ができる）
- React 19対応済み（v3.30.0）
- props形式のスタイリングでTypeScript補完が効く
- アクセシビリティが組み込み済み
- 50+のコンポーネントで十分なカバレッジ

---

## 概要

| 項目 | 内容 |
|------|------|
| 移行元 | Tailwind CSS 4.x (スクラッチ実装) |
| 移行先 | Chakra UI v3.x |
| 対象 | demo, client 両アプリ |
| ダークモード | 対応（next-themes経由、snippetsに含まれる） |
| デザイン方針 | 大まかなレイアウト維持、細部はChakraデフォルトに寄せる |

## 目的

1. テキストはみ出し等のレイアウト崩れを解消
2. 将来的なメンテナンス性向上
3. 一貫したコンポーネントシステムの導入

---

## Phase 0: セットアップ

### 0.1 依存関係インストール
```bash
pnpm add @chakra-ui/react @emotion/react
```

### 0.2 Chakra UI Snippets追加
```bash
npx @chakra-ui/cli snippet add
```
→ `components/ui/` に再利用可能なコンポーネントが生成される

### 0.3 TypeScript設定確認
`tsconfig.json` で以下を確認:
```json
{
  "compilerOptions": {
    "moduleResolution": "Bundler"
  }
}
```

---

## Phase 1: Demo App 基盤

### 1.1 Provider設定
**ファイル**: `demo/src/main.tsx`

```tsx
import { Provider } from "@/components/ui/provider"

createRoot(rootElement).render(
  <StrictMode>
    <Provider>
      <App />
    </Provider>
  </StrictMode>
)
```

### 1.2 index.css整理
**ファイル**: `demo/src/index.css`

- Tailwindインポート削除
- カスタムアニメーション（recording-pulse等）は残す
- JSONシンタックスハイライトのスタイルは残す

---

## Phase 2: Demo App コンポーネント移行

### 2.1 Header
**ファイル**: `demo/src/components/Header.tsx`
**複雑度**: Low

使用するChakraコンポーネント:
- `HStack` - 横並びレイアウト
- `Heading` - ロゴテキスト
- `Link` - 外部リンク

### 2.2 ModeSelector
**ファイル**: `demo/src/components/ModeSelector.tsx`
**複雑度**: Medium

使用するChakraコンポーネント:
- `ButtonGroup` - ボタングループ
- `Button` - モード切替ボタン

### 2.3 GuidePanel
**ファイル**: `demo/src/components/GuidePanel.tsx`
**複雑度**: Low

使用するChakraコンポーネント:
- `Box` - コンテナ
- `Text` - テキスト表示

### 2.4 ScenarioGrid
**ファイル**: `demo/src/components/ScenarioGrid.tsx`
**複雑度**: Low

使用するChakraコンポーネント:
- `VStack` - 縦並びレイアウト
- `Heading` - セクションタイトル

### 2.5 ScenarioCard
**ファイル**: `demo/src/components/ScenarioCard.tsx`
**複雑度**: Medium

使用するChakraコンポーネント:
- `Card` - カードコンテナ
- `Badge` - メソッド/カテゴリ表示
- `NativeSelect` - ドロップダウン
- `Button` - 実行ボタン
- `HStack`, `VStack` - レイアウト

### 2.6 ResponsePanel
**ファイル**: `demo/src/components/ResponsePanel.tsx`
**複雑度**: High

使用するChakraコンポーネント:
- `Box`, `Flex` - レイアウト
- `Badge` - ステータス/メソッド表示
- `Spinner` - ローディング
- `Alert` - エラー表示
- `Code` - JSON表示
- `IconButton` - コピーボタン

注意点:
- JSONシンタックスハイライトはカスタムCSS維持
- ローディングオーバーレイの実装

### 2.7 App.tsx統合
**ファイル**: `demo/src/App.tsx`
**複雑度**: Low

使用するChakraコンポーネント:
- `Flex` - メインレイアウト
- `Box` - サイドバー/メインエリア

---

## Phase 3: Client App 基盤

### 3.1 Provider設定
**ファイル**: `client/src/main.tsx`

Demo同様にProvider設定

### 3.2 index.css整理
**ファイル**: `client/src/index.css`

Tailwindインポート削除

---

## Phase 4: Client App レイアウト

### 4.1 Layout
**ファイル**: `client/src/components/Layout.tsx`
**複雑度**: Low

使用するChakraコンポーネント:
- `Flex` - 3ペインレイアウト

重要な修正:
```tsx
// overflow問題の修正
<Flex flex={1} minW={0}>
  {children}
</Flex>
```

### 4.2 TopBar
**ファイル**: `client/src/components/TopBar.tsx`
**複雑度**: Medium

使用するChakraコンポーネント:
- `HStack` - 横並び
- `ButtonGroup` + `Button` - モードセレクタ
- `Badge` - 接続状態

---

## Phase 5: Client App ペイン

### 5.1 PatternPane
**ファイル**: `client/src/components/PatternPane.tsx`
**複雑度**: Medium

使用するChakraコンポーネント:
- `Box` - 固定幅コンテナ (`w="150px"`)
- `VStack` - パターンリスト
- `Button` - 操作ボタン

### 5.2 FilePane
**ファイル**: `client/src/components/FilePane.tsx`
**複雑度**: Medium-High

使用するChakraコンポーネント:
- `Box` - 固定幅コンテナ (`w="250px"`)
- `Input` - 検索
- `Accordion` - グループ化
- `Badge` - HTTPメソッド色分け

### 5.3 EditorPane
**ファイル**: `client/src/components/EditorPane.tsx`
**複雑度**: Medium

使用するChakraコンポーネント:
- `Flex` - レイアウト (`minW={0}` 重要)
- `Textarea` - JSONエディタ
- `Button` - 操作ボタン
- `Alert` - パースエラー

---

## Phase 6: Client App ダイアログ/メニュー

### 6.1 PatternMenu
**ファイル**: `client/src/components/PatternMenu.tsx`
**複雑度**: Medium

使用するChakraコンポーネント:
- `Menu`, `MenuButton`, `MenuList`, `MenuItem`
- `IconButton`

### 6.2 CreatePatternModal
**ファイル**: `client/src/components/CreatePatternModal.tsx`
**複雑度**: Medium

使用するChakraコンポーネント:
- `Dialog` (snippets)
- `Input`
- `Button`

### 6.3 ConfirmDialog
**ファイル**: `client/src/components/dialogs/ConfirmDialog.tsx`
**複雑度**: Low

使用するChakraコンポーネント:
- `Dialog` with `role="alertdialog"`

### 6.4 RenameDialog
**ファイル**: `client/src/components/dialogs/RenameDialog.tsx`
**複雑度**: Low

CreatePatternModalと同様のパターン

---

## Phase 7: クリーンアップ

### 7.1 Tailwind削除
```bash
pnpm remove tailwindcss @tailwindcss/postcss autoprefixer
```

### 7.2 設定ファイル削除
- `tailwind.config.js` (存在する場合)
- PostCSS設定からTailwindプラグイン削除

### 7.3 最終確認
```bash
pnpm type-check && pnpm format
pnpm build
```

### 7.4 バンドルサイズ最適化（任意）
Chakra UI追加後、チャンクサイズが500KBを超える場合は以下を検討:
- `dynamic import()` でコード分割
- `build.rollupOptions.output.manualChunks` で手動チャンク設定
- 未使用コンポーネントのTree shaking確認

---

## Tailwind → Chakra 変換早見表

| Tailwind | Chakra UI |
|----------|-----------|
| `flex` | `<Flex>` または `display="flex"` |
| `flex-col` | `direction="column"` |
| `flex-1` | `flex={1}` |
| `min-w-0` | `minW={0}` |
| `shrink-0` | `flexShrink={0}` |
| `items-center` | `alignItems="center"` |
| `justify-between` | `justifyContent="space-between"` |
| `gap-2` | `gap={2}` |
| `p-4` | `p={4}` |
| `px-3 py-2` | `px={3} py={2}` |
| `rounded-lg` | `borderRadius="lg"` |
| `bg-gray-100` | `bg="gray.100"` |
| `text-sm` | `fontSize="sm"` |
| `font-medium` | `fontWeight="medium"` |
| `font-mono` | `fontFamily="mono"` |
| `truncate` | `isTruncated` |
| `overflow-hidden` | `overflow="hidden"` |
| `hover:bg-gray-200` | `_hover={{ bg: "gray.200" }}` |
| `cursor-pointer` | `cursor="pointer"` |
| `w-[150px]` | `w="150px"` |
| `h-screen` | `h="100vh"` |

---

## HTTPメソッド色マッピング

| Method | Chakra colorScheme |
|--------|-------------------|
| GET | `green` |
| POST | `blue` |
| PUT | `orange` |
| PATCH | `yellow` |
| DELETE | `red` |
| OPTIONS | `purple` |
| HEAD | `gray` |

---

## 参考リンク

### Chakra UI v3 公式ドキュメント

| ページ | URL |
|--------|-----|
| Getting Started | https://chakra-ui.com/docs/get-started/overview |
| Installation (Vite) | https://chakra-ui.com/docs/get-started/frameworks/vite |
| Styling Concepts | https://chakra-ui.com/docs/styling/overview |
| Color Mode | https://chakra-ui.com/docs/styling/color-mode |

### コンポーネントリファレンス

| コンポーネント | URL |
|---------------|-----|
| Box / Flex | https://chakra-ui.com/docs/components/box |
| Button | https://chakra-ui.com/docs/components/button |
| Input | https://chakra-ui.com/docs/components/input |
| Menu | https://chakra-ui.com/docs/components/menu |
| Dialog (Modal) | https://chakra-ui.com/docs/components/dialog |
| Alert | https://chakra-ui.com/docs/components/alert |
| Badge | https://chakra-ui.com/docs/components/badge |
| Accordion | https://chakra-ui.com/docs/components/accordion |
| Spinner | https://chakra-ui.com/docs/components/spinner |

### 移行・その他

| ページ | URL |
|--------|-----|
| v2 → v3 Migration | https://chakra-ui.com/docs/get-started/migration |
| Chakra UI GitHub | https://github.com/chakra-ui/chakra-ui |
| Chakra UI + Tailwind 併用 | https://www.geeksforgeeks.org/css/it-is-possible-to-mix-chakra-ui-with-tailwind-css/ |
