# Client Scenariosãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆå¯¾å¿œ

## æ¦‚è¦
ScenarioPaneã‚’ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã«å¯¾å¿œã•ã›ã‚‹ï¼ˆ1éšå±¤ã®ã¿ï¼‰

## ãƒ«ãƒ¼ãƒ«
- rootç›´ä¸‹ = ãƒ•ã‚©ãƒ«ãƒ€ã®ã¿è¡¨ç¤º
- ãƒ•ã‚©ãƒ«ãƒ€å†… = ã‚·ãƒŠãƒªã‚ªã®ã¿è¡¨ç¤º
- æ—¢å­˜ã‚·ãƒŠãƒªã‚ªï¼ˆä¾‹: `demo`ï¼‰â†’ `_demo/demo/` ã«è‡ªå‹•ç§»è¡Œ

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
.snaperro/files/
â”œâ”€â”€ api-v1/              â† ãƒ•ã‚©ãƒ«ãƒ€
â”‚   â”œâ”€â”€ users/           â† ã‚·ãƒŠãƒªã‚ª
â”‚   â””â”€â”€ posts/           â† ã‚·ãƒŠãƒªã‚ª
â”œâ”€â”€ _demo/               â† ç§»è¡Œã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€
â”‚   â””â”€â”€ demo/            â† å…ƒã®ã‚·ãƒŠãƒªã‚ª
â””â”€â”€ test/
    â””â”€â”€ default/
```

---

## å®Ÿè£…è¨ˆç”»

### Phase 1: ã‚µãƒ¼ãƒãƒ¼å´ - storage.ts
**ãƒ•ã‚¡ã‚¤ãƒ«:** `server/core/storage.ts`

1. æ–°ã—ã„å‹å®šç¾©è¿½åŠ 
   ```typescript
   interface FolderInfo {
     name: string;
     scenariosCount: number;
   }
   ```

2. æ–°ã—ã„é–¢æ•°è¿½åŠ 
   - `listFolders()`: ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§å–å¾—
   - `listScenariosInFolder(folder)`: ãƒ•ã‚©ãƒ«ãƒ€å†…ã‚·ãƒŠãƒªã‚ªä¸€è¦§
   - `createFolder(name)`: ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
   - `deleteFolder(name)`: ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤
   - `renameFolder(oldName, newName)`: ãƒ•ã‚©ãƒ«ãƒ€åå¤‰æ›´
   - `migrateRootScenarios()`: æ—¢å­˜ã‚·ãƒŠãƒªã‚ªã®è‡ªå‹•ç§»è¡Œ

3. æ—¢å­˜é–¢æ•°ä¿®æ­£
   - `listScenarios()`: `folder/scenario` å½¢å¼ã‚’è¿”ã™
   - `createScenario()`: `folder/scenario` å½¢å¼ã‚’å—ã‘å…¥ã‚Œ
   - ãã®ä»–ãƒ‘ã‚¹è§£æ±ºãƒ­ã‚¸ãƒƒã‚¯ã®æ›´æ–°

### Phase 2: ã‚µãƒ¼ãƒãƒ¼å´ - API
**ãƒ•ã‚¡ã‚¤ãƒ«:** `server/handlers/control-api.ts`

1. æ–°ã—ã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
   - `GET /__snaperro__/folders` - ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§
   - `POST /__snaperro__/folders` - ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
   - `DELETE /__snaperro__/folders/:name` - ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤
   - `PUT /__snaperro__/folders/:name/rename` - ãƒ•ã‚©ãƒ«ãƒ€åå¤‰æ›´
   - `GET /__snaperro__/folders/:folder/scenarios` - ãƒ•ã‚©ãƒ«ãƒ€å†…ã‚·ãƒŠãƒªã‚ªä¸€è¦§

2. SSEã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
   - `folder_created`, `folder_deleted`, `folder_renamed`

3. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ã« `migrateRootScenarios()` ã‚’å®Ÿè¡Œ

### Phase 3: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ - å‹å®šç¾©
**ãƒ•ã‚¡ã‚¤ãƒ«:** `client/src/types/index.ts`

1. `FolderInfo` å‹è¿½åŠ 
2. `SnaperroState` ã« `folders`, `currentFolder` è¿½åŠ 
3. æ–°ã—ã„SSEã‚¤ãƒ™ãƒ³ãƒˆå‹è¿½åŠ 

### Phase 4: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ - hooks
**ãƒ•ã‚¡ã‚¤ãƒ«:** `client/src/hooks/useSnaperroSSE.ts`, `useSnaperroAPI.ts`

1. `useSnaperroSSE`: æ–°ã—ã„çŠ¶æ…‹ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©è¿½åŠ 
2. `useSnaperroAPI`: ãƒ•ã‚©ãƒ«ãƒ€æ“ä½œAPIè¿½åŠ 

### Phase 5: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ - UI
**ãƒ•ã‚¡ã‚¤ãƒ«:** `client/src/components/ScenarioPane.tsx`, `App.tsx`

1. `ScenarioPane.tsx` æ”¹ä¿®
   - ãƒ«ãƒ¼ãƒˆè¡¨ç¤º: ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§ï¼ˆãƒ•ã‚©ãƒ«ãƒ€ã‚¢ã‚¤ã‚³ãƒ³ä»˜ãï¼‰
   - ãƒ•ã‚©ãƒ«ãƒ€å†…è¡¨ç¤º: ã‚·ãƒŠãƒªã‚ªä¸€è¦§ + æˆ»ã‚‹ãƒœã‚¿ãƒ³
   - ãƒ˜ãƒƒãƒ€ãƒ¼ã«ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆè¡¨ç¤º

2. `App.tsx` ã« `currentFolder` çŠ¶æ…‹ç®¡ç†è¿½åŠ 

3. æ–°è¦ãƒ¢ãƒ¼ãƒ€ãƒ«è¿½åŠ 
   - `CreateFolderModal.tsx`

---

## ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´å†…å®¹ |
|---------|---------|
| `server/core/storage.ts` | ãƒ•ã‚©ãƒ«ãƒ€æ“ä½œé–¢æ•°ã€ç§»è¡Œãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ  |
| `server/handlers/control-api.ts` | ãƒ•ã‚©ãƒ«ãƒ€APIè¿½åŠ ã€SSEã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ  |
| `server/types/sse.ts` | æ–°SSEã‚¤ãƒ™ãƒ³ãƒˆå‹è¿½åŠ  |
| `client/src/types/index.ts` | FolderInfoå‹ã€çŠ¶æ…‹æ‹¡å¼µ |
| `client/src/hooks/useSnaperroSSE.ts` | ãƒ•ã‚©ãƒ«ãƒ€çŠ¶æ…‹ç®¡ç† |
| `client/src/hooks/useSnaperroAPI.ts` | ãƒ•ã‚©ãƒ«ãƒ€APIé–¢æ•°è¿½åŠ  |
| `client/src/components/ScenarioPane.tsx` | ãƒ•ã‚©ãƒ«ãƒ€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³UI |
| `client/src/components/App.tsx` | currentFolderçŠ¶æ…‹ã€ãƒãƒ³ãƒ‰ãƒ©è¿½åŠ  |
| `client/src/components/CreateFolderModal.tsx` | æ–°è¦ä½œæˆ |
| `cli/commands/init.ts` | åˆæœŸç”Ÿæˆã‚’ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã«å¯¾å¿œ |

---

## UIè¨­è¨ˆï¼ˆScenarioPaneï¼‰

### rootè¡¨ç¤ºï¼ˆãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Folders                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ api-v1         (3)    â‹®  â”‚  â† ãƒ•ã‚©ãƒ«ãƒ€ + ã‚·ãƒŠãƒªã‚ªæ•° + ãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”‚ ğŸ“ api-v2         (2)    â‹®  â”‚
â”‚ ğŸ“ _demo          (3)    â‹®  â”‚
â”‚ ğŸ“ test           (1)    â‹®  â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ New]      [Import ZIP]   â”‚  â† ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ•ã‚©ãƒ«ãƒ€æ“ä½œUI
| æ“ä½œ | UI | è©³ç´° |
|------|-----|-----|
| ä½œæˆ | ã€Œ+ Newã€ãƒœã‚¿ãƒ³ | CreateFolderModal ã‚’è¡¨ç¤º |
| å‰Šé™¤ | ã€Œâ‹®ã€â†’ Delete | ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°å¾Œã«å‰Šé™¤ |
| ãƒªãƒãƒ¼ãƒ  | ã€Œâ‹®ã€â†’ Rename | RenameDialog ã‚’è¡¨ç¤º |

**FolderMenuï¼ˆâ‹®ãƒœã‚¿ãƒ³ï¼‰ã®é …ç›®:**
- Rename
- Delete

### ãƒ•ã‚©ãƒ«ãƒ€å†…è¡¨ç¤ºï¼ˆã‚·ãƒŠãƒªã‚ªä¸€è¦§ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—€ api-v1                    â”‚  â† æˆ»ã‚‹ãƒœã‚¿ãƒ³ + ãƒ•ã‚©ãƒ«ãƒ€å
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“„ users                 â‹®  â”‚  â† ã‚·ãƒŠãƒªã‚ª + FileJsonã‚¢ã‚¤ã‚³ãƒ³
â”‚ ğŸ“„ posts                 â‹®  â”‚
â”‚ ğŸ“„ auth                  â‹®  â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ New]      [Import ZIP]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«
- **ãƒ•ã‚©ãƒ«ãƒ€ã‚¢ã‚¤ã‚³ãƒ³**: Lucide `Folder` / `FolderOpen`ï¼ˆhoveræ™‚ï¼‰ã€amber.400
- **ã‚·ãƒŠãƒªã‚ªã‚¢ã‚¤ã‚³ãƒ³**: Lucide `FileJson`ã€cyan.400
- **ã‚·ãƒŠãƒªã‚ªæ•°ãƒãƒƒã‚¸**: gray.500ã€å³å¯„ã›
- **æˆ»ã‚‹ãƒœã‚¿ãƒ³**: `ChevronLeft` ã‚¢ã‚¤ã‚³ãƒ³ + ãƒ•ã‚©ãƒ«ãƒ€å
- **ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³**: ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå·¦å³ï¼‰

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ
```
ScenarioPane
â”œâ”€â”€ FolderHeader        # "Folders" or "â—€ folderName"
â”œâ”€â”€ FolderList          # ãƒ•ã‚©ãƒ«ãƒ€ä¸€è¦§ï¼ˆrootæ™‚ï¼‰
â”‚   â””â”€â”€ FolderItem      # å„ãƒ•ã‚©ãƒ«ãƒ€è¡Œ
â”‚       â””â”€â”€ FolderMenu  # ãƒ•ã‚©ãƒ«ãƒ€ç”¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”œâ”€â”€ ScenarioList        # ã‚·ãƒŠãƒªã‚ªä¸€è¦§ï¼ˆãƒ•ã‚©ãƒ«ãƒ€å†…æ™‚ï¼‰
â”‚   â””â”€â”€ ScenarioItem    # å„ã‚·ãƒŠãƒªã‚ªè¡Œï¼ˆæ—¢å­˜ï¼‰
â”‚       â””â”€â”€ ScenarioMenu # ã‚·ãƒŠãƒªã‚ªç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆæ—¢å­˜ï¼‰
â””â”€â”€ BottomActions       # + New / Import ZIP
```

---

## ç§»è¡Œãƒ­ã‚¸ãƒƒã‚¯

ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ã«è‡ªå‹•å®Ÿè¡Œï¼š
1. `BASE_DIR` ç›´ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’èµ°æŸ»
2. ç›´ä¸‹ã« `.json` ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ = æ—§ã‚·ãƒŠãƒªã‚ªï¼ˆç§»è¡Œå¯¾è±¡ï¼‰
3. `demo` â†’ `_demo/demo` ã«ç§»å‹•
4. å†ªç­‰æ€§ã‚’æŒã¤ï¼ˆå†å®Ÿè¡Œã—ã¦ã‚‚å®‰å…¨ï¼‰
