# パターンからシナリオへの名称変更計画

## 概要

コードベース全体で「pattern/パターン」を「scenario/シナリオ」に変更する。

## 背景

- 「パターン」という名称を「シナリオ」に統一することで、モックデータセットの概念をより明確に表現する
- 全ての変数名、型名、関数名、APIパス、UIラベル、ドキュメントを対象とする

## 影響範囲サマリー

| カテゴリ | ファイル数 |
|---------|-----------|
| ソースファイル | 30+ |
| テストファイル | 10+ |
| ドキュメント | 20+ |

## 変更対象一覧

### 用語の変換ルール

| 変更前 | 変更後 | 備考 |
|--------|--------|------|
| `pattern` | `scenario` | 変数名、プロパティ名 |
| `patterns` | `scenarios` | 配列・複数形 |
| `Pattern` | `Scenario` | 型名、インターフェース名 |
| `currentPattern` | `currentScenario` | 状態管理 |
| `/patterns` | `/scenarios` | APIエンドポイント |
| `pattern_changed` | `scenario_changed` | SSEイベント |
| `pattern_created` | `scenario_created` | SSEイベント |
| `pattern_deleted` | `scenario_deleted` | SSEイベント |
| `pattern_renamed` | `scenario_renamed` | SSEイベント |
| `patternsCount` | `scenariosCount` | カウント |
| パターン | シナリオ | 日本語ドキュメント |

### 特別な対応: matcher.ts

`matcher.ts`の「ルートパターン」関連は技術用語として別扱いとし、「Route」に変更する:

| 変更前 | 変更後 | 理由 |
|--------|--------|------|
| `ParsedPattern` | `ParsedRoute` | ルートの解析結果を表す |
| `parseRoutePattern` | `parseRoute` | ルート文字列をパースする関数 |

---

## 実装フェーズ

### Phase 1: 共有型定義の変更

最初に型定義を変更することで、コンパイラが依存箇所を特定してくれる。

#### 1.1 shared/types/sse.ts

**変更内容:**
- `SSEEventType`の値: `pattern_*` → `scenario_*`
- `FolderInfo.patternsCount` → `scenariosCount`
- `PatternChangedEventData` → `ScenarioChangedEventData`
- `PatternCreatedEventData` → `ScenarioCreatedEventData`
- `PatternDeletedEventData` → `ScenarioDeletedEventData`
- `PatternRenamedEventData` → `ScenarioRenamedEventData`
- `ConnectedEventData.currentPattern` → `currentScenario`
- `ConnectedEventData.patterns` → `scenarios`
- `FileChangedEventData.pattern` → `scenario`
- `FileDeletedEventData.pattern` → `scenario`
- `FolderCreatedEventData.patternsCount` → `scenariosCount`
- `FolderCreatedEventData.patterns` → `scenarios`

#### 1.2 client/src/types/index.ts

**変更内容:**
- `PatternInfo` → `ScenarioInfo`
- `SnaperroState.currentPattern` → `currentScenario`
- `SnaperroState.patterns` → `scenarios`

---

### Phase 2: サーバーコアの変更

#### 2.1 server/core/matcher.ts

**変更内容:**
- `ParsedPattern` → `ParsedRoute`
- `parseRoutePattern()` → `parseRoute()`
- コメント内の「パターン」→「ルート」

#### 2.2 server/core/storage.ts

**変更内容:**
- 型: `PatternMetadata` → `ScenarioMetadata`
- 関数名:
  - `listPatterns` → `listScenarios`
  - `patternExists` → `scenarioExists`
  - `createPattern` → `createScenario`
  - `deletePattern` → `deleteScenario`
  - `renamePattern` → `renameScenario`
  - `duplicatePattern` → `duplicateScenario`
  - `getPatternFiles` → `getScenarioFiles`
- 変数名: `pattern` → `scenario`
- SSEイベント: `pattern_*` → `scenario_*`

#### 2.3 server/core/state.ts

**変更内容:**
- `PersistedState.currentPattern` → `currentScenario`
- `getPattern()` → `getScenario()`
- `setPattern()` → `setScenario()`
- 内部変数: `pattern` → `scenario`

#### 2.4 server/core/event-bus.ts

**変更内容:**
- 型参照の更新（インポート元の型名変更に追従）

---

### Phase 3: サーバーハンドラーの変更

#### 3.1 server/handlers/control-api.ts

**変更内容:**
- APIエンドポイント:
  - `GET /patterns` → `GET /scenarios`
  - `GET /patterns/current` → `GET /scenarios/current`
  - `PUT /patterns/current` → `PUT /scenarios/current`
  - `POST /patterns` → `POST /scenarios`
  - `POST /patterns/:name/duplicate` → `POST /scenarios/:name/duplicate`
  - `PUT /patterns/:name/rename` → `PUT /scenarios/:name/rename`
  - `DELETE /patterns/:name` → `DELETE /scenarios/:name`
  - `GET /patterns/:pattern/files` → `GET /scenarios/:scenario/files`
  - `POST /patterns/:pattern/files` → `POST /scenarios/:scenario/files`
  - `PUT /patterns/:pattern/files/:file` → `PUT /scenarios/:scenario/files/:file`
  - `DELETE /patterns/:pattern/files/:file` → `DELETE /scenarios/:scenario/files/:file`
- 変数名・レスポンスキーの変更

#### 3.2 server/handlers/mocker.ts

**変更内容:**
- 変数名: `pattern` → `scenario`
- 関数呼び出しの更新

#### 3.3 server/handlers/recorder.ts

**変更内容:**
- 変数名: `pattern` → `scenario`
- 関数呼び出しの更新

#### 3.4 server/handlers/smart.ts

**変更内容:**
- 変数名: `pattern` → `scenario`
- 関数呼び出しの更新

#### 3.5 server/handlers/handler.ts, index.ts

**変更内容:**
- コメント更新

---

### Phase 4: クライアントの変更

#### 4.1 hooks（ファイル名変更含む）

| 変更前 | 変更後 |
|--------|--------|
| `usePatternNavigation.ts` | `useScenarioNavigation.ts` |

**各ファイルの変更内容:**

- `useScenarioNavigation.ts`: 全変数名・関数名・型名
- `useSnaperroSSE.ts`: イベントハンドラ、変数名
- `useSnaperroAPI.ts`: APIパス `/patterns` → `/scenarios`、関数名
- `useFileEditor.ts`: `currentPattern` → `currentScenario`

#### 4.2 components（ファイル名変更含む）

| 変更前 | 変更後 |
|--------|--------|
| `PatternPane.tsx` | `ScenarioPane.tsx` |
| `PatternMenu.tsx` | `ScenarioMenu.tsx` |
| `CreatePatternModal.tsx` | `CreateScenarioModal.tsx` |

**各ファイルの変更内容:**

- `ScenarioPane.tsx`: 全変数名・props名・コンポーネント名
- `ScenarioMenu.tsx`: 全変数名・props名・コンポーネント名
- `CreateScenarioModal.tsx`: 全変数名・props名・コンポーネント名
- `TopBar.tsx`: `currentPattern` → `currentScenario`
- `App.tsx`: import更新、変数名

---

### Phase 5: テストファイルの更新

| ファイル | 変更内容 |
|---------|---------|
| `server/core/matcher.test.ts` | `parseRoutePattern` → `parseRoute` |
| `server/core/storage.test.ts` | 関数呼び出し、変数名 |
| `server/core/state.test.ts` | `currentPattern` → `currentScenario` |
| `server/core/event-bus.test.ts` | イベントデータ |
| `server/core/api-response.test.ts` | 変数名 |
| `server/handlers/control-api.test.ts` | APIパス、変数名（最大の変更量） |
| `server/handlers/handler.test.ts` | 変数名 |
| `server/handlers/mocker.test.ts` | 変数名 |
| `server/handlers/recorder.test.ts` | 変数名 |
| `server/handlers/smart.test.ts` | 変数名 |

---

### Phase 6: ドキュメントの更新

#### 6.1 README

| ファイル | 変更内容 |
|---------|---------|
| `README.md` | pattern → scenario |
| `README_ja.md` | パターン → シナリオ |

#### 6.2 doc/ フォルダ

以下のファイルで「パターン」→「シナリオ」を置換:

- `2025-11-29_プロジェクト方針.md`
- `2025-12-02_01_概要.md`
- `2025-12-02_02_サーバー仕様.md`
- `2025-12-02_03_内部API仕様.md`
- `2025-12-02_04_設定ファイル仕様.md`
- `2025-12-02_05_CLIコマンド仕様.md`
- `2025-12-02_06_JSONスキーマ仕様.md`
- `2025-12-02_07_実装修正計画.md`
- `2025-12-02_08_RESTful_API変更仕様.md`
- `2025-12-04_GUI仕様.md`
- `2025-12-04_SSE仕様.md`
- `2025-12-06_デモ機能仕様.md`
- `2025-12-13_ChakraUI移行計画.md`
- `2025-12-13_フォルダ構成対応計画.md`
- `2025-12-14_検索機能強化仕様.md`
- `2025-12-16_smartモード実装計画.md`

#### 6.3 その他

| ファイル | 変更内容 |
|---------|---------|
| `debug/postman-collection.json` | パターン → シナリオ |

---

### Phase 7: CLI の更新

#### 7.1 cli/commands/init.ts

**変更内容:**
- コンソールメッセージ: `patterns` → `scenarios`

---

## 検証コマンド

各Phase完了後に以下を実行:

```bash
pnpm type-check        # TypeScript型チェック
pnpm type-check:client # クライアント型チェック
pnpm type-check:demo   # デモ型チェック
pnpm format            # Biomeフォーマット
pnpm test              # テスト実行
```

---

## 注意事項

### Breaking Changes

1. **APIエンドポイントの変更**: `/patterns` → `/scenarios` はクライアント側との同時更新が必須
2. **SSEイベント名の変更**: イベント名が変わるため、クライアントとサーバーを同時に更新
3. **状態ファイルの互換性**: `.snaperro/state.json` の `currentPattern` → `currentScenario`

### 実行順序の重要性

- Phase 1-4 は依存関係があるため連続して実行
- 中間状態では型チェックが通らないため、全変更を1ブランチで行いアトミックにマージ推奨

---

## Critical Files

優先的に変更するファイル:

1. `shared/types/sse.ts` - 全ての型定義の起点
2. `server/core/storage.ts` - コアロジック
3. `server/handlers/control-api.ts` - API定義
4. `client/src/hooks/useSnaperroSSE.ts` - SSE処理
5. `client/src/hooks/useSnaperroAPI.ts` - API呼び出し
